{
  "hash": "8d49bb70bd1b4bbd4695571f92d49fdf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Bar chart template\"\nauthor: \"Matthew Kuch\"\ndate: \"2025-04-12\"\ncategories: [Data Visualization, Data Analysis]\nimage: \"./assets/original_economist_bar.png\"\ndescription: \"A nice looking Economist-esque bar chart \"\nformat: \n  html:\n    toc: true\n    toc-depth: 3\n    toc-title: \"Contents\"\n    code-fold: true\n    code-tools: false\n    code-copy: true\n    echo: true\n---\n\n\n\n## Load packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(grid)\nlibrary(tidyverse)\nlibrary(shadowtext)\n```\n:::\n\n\n\n## Original chart we're trying to recreate\n\n![Original](./assets/original_economist_bar.png)\n\n\n## Create dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames <- c(\n    \"Hantavirus\", \"Tularemia\", \"Dengue\", \"Ebola\", \"E. coli\", \n    \"Tuberculosis\", \"Salmonella\", \"Vaccinia\", \"Brucella\"\n  )\n  \n# Name is an ordered factor. We do this to ensure the bars are sorted.\ndata <- data.frame(\n  count = c(6, 7, 7, 9, 11, 15, 17, 18, 54), \n  name = factor(names, levels = names),\n  y = seq(length(names)) * 0.9\n)\n\n# Let's also define the colors\nBLUE <- \"#076fa2\"\nRED <- \"#E3120B\"\nBLACK <- \"#202020\"\nGREY <- \"grey50\"\n```\n:::\n\n\n\n\n## Basic Bar Chart\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplt <- ggplot(data) +\n  geom_col(aes(count, name), fill = BLUE, width = 0.6) \n\nplt\n```\n\n::: {.cell-output-display}\n![Basic Bar Chart](bar-chart-template_files/figure-html/data-viz-v1-1.png){width=672}\n:::\n:::\n\n\n\n## Customized Bar chart - v2 layout\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Working on the x and y scales + adjusting the axes\n\nplt2 <- plt + \n  scale_x_continuous(\n    limits = c(0, 55.5),\n    breaks = seq(0, 55, by = 5), \n    expand = c(0, 0), # The horizontal axis does not extend to either side\n    position = \"top\"  # Labels are located on the top\n  ) +\n  \n  # The vertical axis only extends upwards \n  scale_y_discrete(expand = expansion(add = c(0, 0.5))) +\n  theme(\n    \n    # Set background color to white\n    panel.background = element_rect(fill = \"white\"),\n    \n    # Set the color and the width of the grid lines for the horizontal axis\n    panel.grid.major.x = element_line(color = \"#A8BAC4\", size = 0.3),\n    \n    # Remove tick marks by setting their length to 0\n    axis.ticks.length = unit(0, \"mm\"),\n    \n    # Remove the title for both axes\n    axis.title = element_blank(),\n    \n    # Only left line of the vertical axis is painted in black\n    axis.line.y.left = element_line(color = \"black\"),\n    \n    # Remove labels from the vertical axis\n    axis.text.y = element_blank(),\n    \n    # But customize labels for the horizontal axis\n    axis.text.x = element_text(family = \"Econ Sans Cnd\", size = 16)\n  )\n\nplt2\n```\n\n::: {.cell-output-display}\n![Bar Chart - v2](bar-chart-template_files/figure-html/data-viz-v2-1.png){width=672}\n:::\n:::\n\n\n## Bar chart - v3 - Adding Labels\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Adding Labels\nplt3 <- plt2 + \n  geom_shadowtext( # used to draw text with shadow to the right of the bars of the diseases with a count below 8\n    data = subset(data, count < 8),\n    aes(count, y = name, label = name),\n    hjust = 0,\n    nudge_x = 0.3,\n    colour = BLUE,\n    bg.colour = \"white\",\n    bg.r = 0.2,\n    family = \"Econ Sans Cnd\",\n    size = 7\n  ) + \n  geom_text( # used to draw regular text within the bars of the diseases with a count equal or above 8\n    data = subset(data, count >= 8),\n    aes(0, y = name, label = name),\n    hjust = 0,\n    nudge_x = 0.3,\n    colour = \"white\",\n    family = \"Econ Sans Cnd\",\n    size = 7\n  )\n\nplt3\n```\n\n::: {.cell-output-display}\n![Bar Chart - v3 - with Labels](bar-chart-template_files/figure-html/data-viz-v3-1.png){width=672}\n:::\n:::\n\n\n\n## Bar chart - v4 - Adding Annotations and More Tweaks\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplt4 <- plt3 +\n  labs(\n    title = \"Escape artists\",\n    subtitle = \"Number of laboratory-acquired infections, 1970-2021\"\n  ) + \n  theme(\n    plot.title = element_text(\n      family = \"Econ Sans Cnd\", \n      face = \"bold\",\n      size = 22\n    ),\n    plot.subtitle = element_text(\n      family = \"Econ Sans Cnd\",\n      size = 20\n    )\n  )\n\nplt4\n```\n\n::: {.cell-output-display}\n![Bar Chart - v4 - Annotations and More Tweaks](bar-chart-template_files/figure-html/data-viz-v4-1.png){width=672}\n:::\n:::\n\n\n## Just a little more, to get it closer to the original\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make room for more annotations\nplt5 <- plt4 + \n  theme(\n    plot.margin = margin(0.05, 0, 0.1, 0.01, \"npc\") # top, bottom, left, right\n  )\n\n# Print the ggplot2 plot\nplt5\n\n# Add horizontal line on top\n# It goes from x = 0 (left) to x = 1 (right) on the very top of the chart (y = 1)\n# You can think of 'gp' and 'gpar' as 'graphical parameters'.\n# There we indicate the line color and width\ngrid.lines(\n  x = c(0, 1),\n  y = 1,\n  gp = gpar(col = \"#e5001c\", lwd = 4)\n)\n\n# Add rectangle on top-left\n# lwd = 0 means the rectangle does not have an outer line\n# 'just' gives the horizontal and vertical justification\ngrid.rect(\n  x = 0,\n  y = 1,\n  width = 0.05,\n  height = 0.025,\n  just = c(\"left\", \"top\"),\n  gp = gpar(fill = \"#e5001c\", lwd = 0)\n)\n\n# We have two captions, so we use grid.text instead of \n# the caption provided by  ggplot2.\ngrid.text(\n  \"Sources: Laboratory-Acquired Infection Database; American Biological Safety Association\", \n  x = 0.005, \n  y = 0.06, \n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    col = GREY,\n    fontsize = 16,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\ngrid.text(\n  \"BK Advisors\", \n  x = 0.005, \n  y = 0.005, \n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    col = GREY,\n    fontsize = 16,\n    fontfamily = \"Milo TE W01\"\n  )\n)\n```\n\n::: {.cell-output-display}\n![Bar Chart - v5 - Top line and other things using the grid library](bar-chart-template_files/figure-html/data-viz-v5-1.png){width=672}\n:::\n:::\n\n\n\n## Final polish - v6\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Going the extramile\n\nplt6 <- plt5 + \n  labs(title = NULL, subtitle = NULL) +\n  theme(\n    plot.margin = margin(0.15, 0, 0.1, 0.01, \"npc\")\n  )\n\nplt6 \n\ngrid.text(\n  \"Escape artists\", \n  0, \n  0.925,\n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    fontsize = 22,\n    fontface = \"bold\",\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.text(\n  \"Number of laboratory-acquired infections, 1970-2021\", \n  0, \n  0.875,\n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    fontsize = 20,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.lines(\n  x = c(0, 1),\n  y = 1,\n  gp = gpar(col = \"#e5001c\", lwd = 4)\n)\n\ngrid.rect(\n  x = 0,\n  y = 1,\n  width = 0.05,\n  height = 0.025,\n  just = c(\"left\", \"top\"),\n  gp = gpar(fill = \"#e5001c\", lwd = 0)\n)\n\ngrid.text(\n  \"Sources: Laboratory-Acquired Infection Database; American Biological Safety Association\", \n  x = 0.005, \n  y = 0.06, \n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    col = GREY,\n    fontsize = 16,\n    fontfamily = \"Econ Sans Cnd\"\n  )\n)\n\ngrid.text(\n  \"BK Advisors\", \n  x = 0.005, \n  y = 0.005, \n  just = c(\"left\", \"bottom\"),\n  gp = gpar(\n    col = GREY,\n    fontsize = 16,\n    fontfamily = \"Milo TE W01\"\n  )\n)\n```\n\n::: {.cell-output-display}\n![Bar Chart - v6 - Final polish](bar-chart-template_files/figure-html/data-viz-v6-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## References\n\n::: {#refs}\n:::",
    "supporting": [
      "bar-chart-template_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}